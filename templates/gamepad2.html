<html> 
    <head> 
      <title>Test </title> 
      <script src="http://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <body> 
      <h1>Test Mode 2</h1> 

    </body>

    <script>
        //connect gamepad from window
        window.addEventListener("gamepadconnected", function(e) {
          console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",
            e.gamepad.index, e.gamepad.id,
            e.gamepad.buttons.length, e.gamepad.axes.length);
        });
        //set controller as gp
        var gp = navigator.getGamepads()[0];
        //disconnect gamepad from window
        window.addEventListener("gamepaddisconnected", function(e) {
          console.log("Gamepad disconnected from index %d: %s",
            e.gamepad.index, e.gamepad.id);
        });
        //apply Deadzone so no motor running when at rest
        var applyDeadzone = function(number, threshold){
          percentage = (Math.abs(number) - threshold) / (1 - threshold);
          if(percentage < 0)
            percentage = 0;
          return percentage * (number > 0 ? 1 : -1);
        }
        //var xaxis = applyDeadzone(gp.axes[0], 0.25);
        //var yaxis = applyDeadzone(gp.axes[1], 0.25);
        //console log controller axis positions
        function logController() {
          gp = navigator.getGamepads()[0];
          console.log(gp.axes[1]);
          console.log(gp.axes[3]);
        }
        //setInterval(logController, 100)
        //runs python script in app.py

  

        function controls() {
          controlMode = false;

          gp = navigator.getGamepads()[0];

          shutdown = gp.buttons[11].pressed;

          shoulderControls = applyDeadzone(gp.axes[1], 0.15);
          elbowControls = applyDeadzone(gp.axes[3], 0.15);

          turretControls = applyDeadzone(gp.axes[0], 0.15);
          wristControls = applyDeadzone(gp.axes[2], 0.15);

          clawOpen = gp.buttons[6].value;
          clawClose = gp.buttons[7].value;

          $.ajax({
            url: "{{ url_for('mode_two') }}",
            type: 'POST',
            data: {'shutdown':shutdown,'shoulderControls': shoulderControls, 'elbowControls': elbowControls, 'turretControls': turretControls, 'wristControls': wristControls, 'clawOpen': clawOpen, 'clawClose': clawClose},
            success: function(response) {
              console.log("Turret Mode Sent");
            }
          });
        }
        setInterval(controls, 100);
    </script>
</html>